<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PolyEvolve Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div id="screen-splash" class="screen active flex flex-col items-center justify-center bg-[radial-gradient(ellipse_at_center,_var(--bg-dark)_0%,_#000_100%)]">
        <h1 class="text-6xl font-black mb-2 text-transparent bg-clip-text bg-gradient-to-r from-[var(--primary)] to-purple-500 tracking-tighter">
            EVOLVE<span class="text-white font-light">LAB</span>
        </h1>
        <p class="text-gray-400 mb-8 tracking-widest text-sm">NEURAL NEUROEVOLUTION ENGINE</p>
        <button id="btn-start-draw" class="btn-primary px-8 py-4 rounded-full text-xl shadow-lg">
            <i class="fas fa-hammer mr-2"></i> Build Creature
        </button>
    </div>

    <div id="screen-draw" class="screen bg-[#111]">
        <div id="design-area" class="absolute inset-0 cursor-crosshair"></div>
        <div class="absolute top-4 left-1/2 -translate-x-1/2 glass-panel p-2 flex gap-2 flex-wrap justify-center max-w-[96vw]">
            <button class="btn-tool active" id="tool-node" title="Add Joint"><i class="fas fa-circle-dot"></i></button>
            <button class="btn-tool" id="tool-bone" title="Add Bone"><i class="fas fa-bone"></i></button>
            <button class="btn-tool" id="tool-muscle" title="Add Muscle"><i class="fas fa-dna"></i></button>
            <button class="btn-tool" id="tool-move" title="Move"><i class="fas fa-up-down-left-right"></i></button>
            <button class="btn-tool" id="tool-erase" title="Erase"><i class="fas fa-eraser"></i></button>
            <button class="btn-tool text-yellow-300 hover:text-yellow-200" id="tool-undo" title="Undo"><i class="fas fa-rotate-left"></i></button>
            <div class="w-px bg-white/10 mx-1"></div>
            <button class="btn-tool text-emerald-300 hover:text-emerald-200" id="tool-save" title="Save Design"><i class="fas fa-floppy-disk"></i></button>
            <button class="btn-tool text-sky-300 hover:text-sky-200" id="tool-load" title="Load Design"><i class="fas fa-folder-open"></i></button>
            <input id="design-file-input" type="file" accept=".json,application/json" class="hidden">
            <button class="btn-tool text-red-400 hover:text-red-500" id="tool-clear" title="Clear All"><i class="fas fa-trash"></i></button>
            <div class="w-px bg-white/10 mx-1"></div>
            <select id="preset-select" class="bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm text-gray-300 cursor-pointer hover:bg-white/10">
                <option value="-1">Load Preset...</option>
            </select>
        </div>

        <div class="absolute bottom-24 left-1/2 -translate-x-1/2 text-gray-400 text-sm font-mono pointer-events-none text-center px-4">
            <span id="hint-text">Click to add joints.</span>
        </div>

        <div class="absolute bottom-6 w-full flex justify-center gap-4 pointer-events-none">
            <button id="btn-back" class="glass-panel px-6 py-3 text-white pointer-events-auto hover:bg-white/10 transition">
                <i class="fas fa-arrow-left"></i>
            </button>
            <button id="btn-run" class="btn-primary px-12 py-3 rounded-xl pointer-events-auto text-lg shadow-[0_0_30px_rgba(0,242,255,0.3)]" disabled>
                EVOLVE <i class="fas fa-play ml-2"></i>
            </button>
        </div>
    </div>

    <div id="screen-sim" class="screen">
        <canvas id="world"></canvas>

        <!-- Generation summary overlay -->
        <div id="gen-summary" class="absolute top-1/3 left-1/2 -translate-x-1/2 glass-panel p-4 text-center pointer-events-none opacity-0 transition-opacity duration-500 z-10">
            <div class="text-lg font-bold text-cyan-300" id="gen-summary-text"></div>
        </div>

        <div class="absolute top-0 w-full p-4 pointer-events-none">
            <div id="panel-hud" class="glass-panel p-3 flex gap-6 text-sm font-mono pointer-events-auto flex-wrap edge-drawer edge-top">
                <div><div class="text-[10px] text-gray-500 uppercase">Generation</div><div class="text-xl font-bold" id="hud-gen">1</div></div>
                <div><div class="text-[10px] text-gray-500 uppercase">Gen Best</div><div class="text-xl font-bold text-cyan-300" id="hud-genbest">0m</div></div>
                <div><div class="text-[10px] text-gray-500 uppercase">All-Time</div><div class="text-xl font-bold text-[var(--primary)]" id="hud-allbest">0m</div></div>
                <div><div class="text-[10px] text-gray-500 uppercase">Delta</div><div class="text-xl font-bold text-emerald-300" id="hud-improve">+0m</div></div>
                <div><div class="text-[10px] text-gray-500 uppercase">Stagnant</div><div class="text-xl font-bold text-amber-300" id="hud-stagnant">0g</div></div>
                <div><div class="text-[10px] text-gray-500 uppercase">Time</div><div class="text-xl font-bold text-yellow-300" id="hud-time">8.0s</div></div>
                <div><div class="text-[10px] text-gray-500 uppercase">FPS</div><div class="text-xl font-bold text-gray-300" id="hud-fps">60</div></div>
            </div>

            <div id="panel-neural" class="glass-panel p-3 w-72 h-44 grid-lines relative overflow-hidden pointer-events-auto border-t-2 border-t-[var(--secondary)] edge-drawer edge-top-right">
                <div class="text-[10px] text-[var(--secondary)] uppercase font-bold mb-1 flex justify-between">
                    <span>Neural Network</span>
                    <i class="fas fa-brain"></i>
                </div>
                <canvas id="nn-canvas" width="260" height="88" class="w-full h-1/2"></canvas>
                <canvas id="progress-canvas" width="260" height="64" class="w-full h-1/2 mt-1"></canvas>
            </div>
        </div>

        <div id="panel-progress-left" class="absolute left-4 top-24 glass-panel p-3 w-80 h-[72vh] pointer-events-auto border-t-2 border-t-cyan-300 edge-drawer edge-left">
            <div class="text-[10px] uppercase tracking-wider text-cyan-300 font-bold mb-2 flex justify-between">
                <span>Evolution Progress</span>
                <span id="left-graph-meta">G1</span>
            </div>
            <canvas id="left-progress-canvas" width="300" height="210" class="w-full h-[210px]"></canvas>
        </div>

        <div id="panel-controls" class="absolute right-4 top-24 glass-panel p-4 flex flex-col gap-3 w-80 h-[72vh] pointer-events-auto transition-transform edge-drawer edge-right overflow-y-auto">
            <div class="flex justify-between gap-2">
                <button id="btn-start-sim" class="flex-1 py-2 rounded bg-emerald-500/15 text-emerald-300 hover:bg-emerald-500/25 border border-emerald-400/30" title="Start Simulation"><i class="fas fa-play"></i></button>
                <button id="btn-pause" class="flex-1 py-2 rounded bg-white/5 hover:bg-white/10 border border-white/10" title="Pause/Play"><i class="fas fa-pause" id="icon-pause"></i></button>
                <button id="btn-reset" class="flex-1 py-2 rounded bg-red-500/10 text-red-400 hover:bg-red-500/20 border border-red-500/30" title="Restart"><i class="fas fa-redo"></i></button>
                <button id="btn-edit" class="flex-1 py-2 rounded bg-[var(--primary)] text-black font-bold hover:brightness-110 shadow-[0_0_10px_rgba(0,242,255,0.3)]" title="Edit"><i class="fas fa-pencil"></i></button>
            </div>
            <button id="btn-reset-settings" class="w-full py-2 rounded bg-white/5 hover:bg-white/10 border border-white/10 text-sm">
                Reset Settings to Defaults
            </button>

            <div class="h-px bg-white/10 my-1"></div>

            <div class="control-group">
                <div class="control-label">Replay <span class="control-val" id="replay-label">G-</span></div>
                <div class="flex gap-2">
                    <button id="replay-prev" class="cam-btn"><i class="fas fa-backward-step"></i></button>
                    <button id="replay-play" class="cam-btn"><i class="fas fa-play" id="replay-play-icon"></i></button>
                    <button id="replay-next" class="cam-btn"><i class="fas fa-forward-step"></i></button>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">Challenges</div>
                <div class="grid grid-cols-2 gap-2">
                    <button id="btn-ground-draw" class="cam-btn">Draw Ground</button>
                    <button id="btn-ground-clear" class="cam-btn">Clear Ground</button>
                    <button id="btn-obstacle-add" class="cam-btn">Add Obstacle</button>
                    <button id="btn-challenge-clear" class="cam-btn">Clear All</button>
                </div>
                <div class="text-[10px] text-gray-400 mt-1">Draw mode: click world to add line points.</div>
            </div>

            <div class="control-group">
                <div class="control-label">Brains</div>
                <div class="grid grid-cols-2 gap-2">
                    <button id="btn-brain-save" class="cam-btn">Save Brain</button>
                    <button id="btn-brain-load" class="cam-btn">Load Brain</button>
                </div>
                <input id="brain-file-input" type="file" accept=".json,application/json" class="hidden">
            </div>

            <div class="control-group">
                <div class="control-label">Fitness Breakdown <span class="control-val" id="fitness-tag">LIVE</span></div>
                <div class="grid grid-cols-2 gap-2 text-xs font-mono">
                    <div class="glass-panel p-2"><div class="text-gray-400">Speed</div><div id="fitness-speed" class="text-cyan-300">0.0</div></div>
                    <div class="glass-panel p-2"><div class="text-gray-400">Stability</div><div id="fitness-stability" class="text-emerald-300">0%</div></div>
                    <div class="glass-panel p-2"><div class="text-gray-400">Airtime</div><div id="fitness-airtime" class="text-amber-300">0%</div></div>
                    <div class="glass-panel p-2"><div class="text-gray-400">Stumbles</div><div id="fitness-stumbles" class="text-rose-300">0</div></div>
                </div>
            </div>

            <div class="h-px bg-white/10 my-1"></div>

            <div class="control-group">
                <div class="control-label">Camera <span class="control-val" id="val-cam">LOCK</span></div>
                <div class="flex gap-2">
                    <button id="cam-lock" class="cam-btn active">Lock</button>
                    <button id="cam-free" class="cam-btn">Free</button>
                    <button id="cam-reset" class="cam-btn">Reset</button>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">Simulation Speed <span class="control-val" id="val-speed">1x</span></div>
                <input type="range" id="inp-speed" min="1" max="120" value="1" step="1">
            </div>

            <div class="control-group">
                <div class="control-label">Zoom <span class="control-val" id="val-zoom">1.00x</span></div>
                <input type="range" id="inp-zoom" min="35" max="250" value="100" step="5">
            </div>

            <div class="control-group">
                <div class="control-label">Generation Time <span class="control-val" id="val-duration">8s</span></div>
                <input type="range" id="inp-duration" min="4" max="20" value="8" step="1">
            </div>

            <div class="control-group">
                <div class="control-label">Population <span class="control-val" id="val-pop">24</span></div>
                <input type="range" id="inp-pop" min="8" max="200" value="24" step="4">
            </div>

            <div class="h-px bg-white/10 my-1"></div>
            <div class="text-[10px] text-purple-300 uppercase font-bold tracking-wider">Neural Network</div>

            <div class="control-group">
                <div class="control-label">Hidden Layers <span class="control-val" id="val-hidden">1</span></div>
                <input type="range" id="inp-hidden" min="1" max="3" value="1" step="1">
            </div>

            <div class="control-group">
                <div class="control-label">Neurons / Layer <span class="control-val" id="val-neurons">12</span></div>
                <input type="range" id="inp-neurons" min="4" max="32" value="12" step="1">
            </div>

            <div class="control-group">
                <div class="control-label">Elite Count <span class="control-val" id="val-elites">2</span></div>
                <input type="range" id="inp-elites" min="1" max="10" value="2" step="1">
            </div>

            <div class="control-group">
                <div class="control-label">Tournament Size <span class="control-val" id="val-tournament">3</span></div>
                <input type="range" id="inp-tournament" min="2" max="8" value="3" step="1">
            </div>

            <div class="h-px bg-white/10 my-1"></div>
            <div class="text-[10px] text-amber-300 uppercase font-bold tracking-wider">Physics</div>

            <div class="control-group">
                <div class="control-label">Muscle Power <span class="control-val" id="val-strength">140%</span></div>
                <input type="range" id="inp-strength" min="20" max="180" value="140" step="10">
            </div>

            <div class="control-group">
                <div class="control-label">Joint Move Speed <span class="control-val" id="val-jointspeed">1.10x</span></div>
                <input type="range" id="inp-jointspeed" min="20" max="200" value="110" step="5">
            </div>

            <div class="control-group">
                <div class="control-label">Joint Freedom <span class="control-val" id="val-joint">100%</span></div>
                <input type="range" id="inp-joint" min="0" max="100" value="100" step="5">
            </div>

            <div class="control-group">
                <div class="control-label">Gravity <span class="control-val" id="val-gravity">1.0</span></div>
                <input type="range" id="inp-gravity" min="0.1" max="3.0" value="1.0" step="0.1">
            </div>

            <div class="control-group">
                <div class="control-label">Ground Friction <span class="control-val" id="val-groundfric">2.00</span></div>
                <input type="range" id="inp-groundfric" min="50" max="600" value="200" step="10">
            </div>

            <div class="control-group">
                <div class="control-label">Ground Static Friction <span class="control-val" id="val-groundstatic">8.00</span></div>
                <input type="range" id="inp-groundstatic" min="100" max="1600" value="800" step="50">
            </div>

            <div class="control-group">
                <div class="control-label">Ground Velocity Keep <span class="control-val" id="val-traction">80%</span></div>
                <input type="range" id="inp-traction" min="40" max="100" value="80" step="1">
            </div>

            <div class="control-group">
                <div class="control-label">Body Friction <span class="control-val" id="val-bodyfric">2.00</span></div>
                <input type="range" id="inp-bodyfric" min="50" max="600" value="200" step="10">
            </div>

            <div class="control-group">
                <div class="control-label">Body Static Friction <span class="control-val" id="val-bodystatic">8.00</span></div>
                <input type="range" id="inp-bodystatic" min="100" max="1600" value="800" step="50">
            </div>

            <div class="control-group">
                <div class="control-label">Body Air Friction <span class="control-val" id="val-bodyair">0.070</span></div>
                <input type="range" id="inp-bodyair" min="0" max="200" value="70" step="2">
            </div>

            <div class="control-group">
                <div class="control-label">Muscle Range <span class="control-val" id="val-musrange">18%</span></div>
                <input type="range" id="inp-musrange" min="5" max="45" value="18" step="1">
            </div>

            <div class="control-group">
                <div class="control-label">Muscle Smoothing <span class="control-val" id="val-musmooth">22%</span></div>
                <input type="range" id="inp-musmooth" min="2" max="50" value="22" step="1">
            </div>

            <div class="h-px bg-white/10 my-1"></div>
            <div class="text-[10px] text-cyan-300 uppercase font-bold tracking-wider">Fitness Weights</div>

            <div class="control-group">
                <div class="control-label">Distance Weight <span class="control-val" id="val-distreward">320</span></div>
                <input type="range" id="inp-distreward" min="100" max="700" value="320" step="10">
            </div>

            <div class="control-group">
                <div class="control-label">Speed Weight <span class="control-val" id="val-speedreward">0.35</span></div>
                <input type="range" id="inp-speedreward" min="0" max="150" value="35" step="1">
            </div>

            <div class="control-group">
                <div class="control-label">Jitter Penalty <span class="control-val" id="val-jitterpen">40</span></div>
                <input type="range" id="inp-jitterpen" min="0" max="250" value="40" step="5">
            </div>

            <div class="control-group">
                <div class="control-label">Ground Slip Penalty <span class="control-val" id="val-slippen">8</span></div>
                <input type="range" id="inp-slippen" min="0" max="40" value="8" step="1">
            </div>

            <div class="h-px bg-white/10 my-1"></div>
            <div class="text-[10px] text-pink-300 uppercase font-bold tracking-wider">Mutation</div>

            <div class="control-group">
                <div class="control-label">Mutation Rate <span class="control-val" id="val-mut">8%</span></div>
                <input type="range" id="inp-mut" min="0" max="60" value="8" step="1">
            </div>

            <div class="control-group">
                <div class="control-label">Mutation Size <span class="control-val" id="val-mutsize">1.00x</span></div>
                <input type="range" id="inp-mutsize" min="20" max="400" value="100" step="5">
            </div>

            <div class="text-[10px] text-gray-400 leading-tight">
                Real feedforward neural network brain.<br>
                Each creature's DNA = NN weight vector.<br>
                Evolution: tournament selection + uniform crossover + gaussian mutation.
            </div>
        </div>

        <div class="edge-tab-rail edge-top-rail pointer-events-auto">
            <button class="edge-tab active" data-target="panel-hud" title="Toggle HUD">HUD</button>
            <button class="edge-tab active" data-target="panel-neural" title="Toggle Neural">Neural</button>
        </div>
        <div class="edge-tab-rail edge-left-rail pointer-events-auto">
            <button class="edge-tab vertical active" data-target="panel-progress-left" title="Toggle Progress">Progress</button>
        </div>
        <div class="edge-tab-rail edge-right-rail pointer-events-auto">
            <button class="edge-tab vertical active" data-target="panel-controls" title="Toggle Controls">Controls</button>
        </div>
    </div>

    <script type="module" src="./main.js"></script>
</body>
</html>
