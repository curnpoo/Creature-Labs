<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        >
        <title>EvolveLab — Neural Neuroevolution Engine</title>
        <meta
            name="description"
            content="Design creatures and watch them learn to walk using real neural network evolution. Build, train, and test AI locomotion."
        >
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        >
        <link rel="stylesheet" href="./styles.css">
    </head>
    <body>
        <!-- ═══ SPLASH SCREEN ═══ -->
        <div
            id="screen-splash"
            class="screen active flex flex-col items-center justify-center bg-[radial-gradient(ellipse_at_center,_var(--bg-dark)_0%,_#000_100%)]"
        >
            <h1
                class="text-6xl font-black mb-2 text-transparent bg-clip-text bg-gradient-to-r from-[var(--primary)] to-purple-500 tracking-tighter"
            >
                EVOLVE<span class="text-white font-light">LAB</span>
            </h1>
            <p
                class="text-gray-400 mb-8 tracking-widest text-sm"
                style="font-family: 'JetBrains Mono', monospace"
            >
                NEURAL NEUROEVOLUTION ENGINE
            </p>
            <button
                id="btn-start-draw"
                class="btn-primary px-8 py-4 rounded-full text-xl shadow-lg"
            >
                <i class="fas fa-hammer mr-2"></i> Build Creature
            </button>
        </div>

        <!-- ═══ DESIGN SCREEN ═══ -->
        <div id="screen-draw" class="screen bg-[#111]">
            <div id="design-area" class="absolute inset-0 cursor-crosshair">
            </div>
            <div
                class="absolute top-4 left-1/2 -translate-x-1/2 glass-panel p-2 flex gap-2 flex-wrap justify-center max-w-[96vw]"
            >
                <button
                    class="btn-tool active"
                    id="tool-node"
                    title="Add Joint"
                >
                    <i class="fas fa-circle-dot"></i>
                </button>
                <button class="btn-tool" id="tool-joint" title="Toggle Joint Type">
                    <i class="fas fa-lock"></i>
                </button>
                <button class="btn-tool" id="tool-bone" title="Add Bone">
                    <i class="fas fa-bone"></i>
                </button>
                <button class="btn-tool" id="tool-muscle" title="Add Muscle">
                    <i class="fas fa-dna"></i>
                </button>
                <button class="btn-tool" id="tool-polygon" title="Draw Polygon Body">
                    <i class="fas fa-draw-polygon"></i>
                </button>
                <button class="btn-tool" id="tool-move" title="Move">
                    <i class="fas fa-up-down-left-right"></i>
                </button>
                <button class="btn-tool" id="tool-erase" title="Erase">
                    <i class="fas fa-eraser"></i>
                </button>
                <button
                    class="btn-tool text-yellow-300 hover:text-yellow-200"
                    id="tool-undo"
                    title="Undo"
                >
                    <i class="fas fa-rotate-left"></i>
                </button>
                <div class="w-px bg-white/10 mx-1"></div>
                <button
                    class="btn-tool text-purple-300 hover:text-purple-200"
                    id="tool-pan"
                    title="Toggle Pan Mode (or hold Space)"
                >
                    <i class="fas fa-hand"></i>
                </button>
                <button
                    class="btn-tool text-blue-300 hover:text-blue-200"
                    id="tool-reset-view"
                    title="Reset Zoom & Pan"
                >
                    <i class="fas fa-expand"></i>
                </button>
                <div class="w-px bg-white/10 mx-1"></div>
                <button
                    class="btn-tool text-emerald-300 hover:text-emerald-200"
                    id="tool-save"
                    title="Save Design"
                >
                    <i class="fas fa-floppy-disk"></i>
                </button>
                <button
                    class="btn-tool text-sky-300 hover:text-sky-200"
                    id="tool-load"
                    title="Load Design"
                >
                    <i class="fas fa-folder-open"></i>
                </button>
                <input
                    id="design-file-input"
                    type="file"
                    accept=".json,application/json"
                    class="hidden"
                >
                <button
                    class="btn-tool text-red-400 hover:text-red-500"
                    id="tool-clear"
                    title="Clear All"
                >
                    <i class="fas fa-trash"></i>
                </button>
                <div class="w-px bg-white/10 mx-1"></div>
                <select
                    id="preset-select"
                    class="bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm text-gray-300 cursor-pointer hover:bg-white/10"
                >
                    <option value="-1">Load Preset...</option>
                </select>
            </div>

            <div
                class="absolute bottom-24 left-1/2 -translate-x-1/2 text-gray-400 text-sm pointer-events-none text-center px-4"
                style="font-family: 'JetBrains Mono', monospace"
            >
                <span id="hint-text">Click to add joints.</span>
            </div>

            <div
                class="absolute bottom-6 w-full flex justify-center gap-4 pointer-events-none"
            >
                <button
                    id="btn-back"
                    class="glass-panel px-6 py-3 text-white pointer-events-auto hover:bg-white/10 transition"
                >
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button
                    id="btn-run"
                    class="btn-primary px-12 py-3 rounded-xl pointer-events-auto text-lg shadow-[0_0_30px_rgba(0,242,255,0.3)]"
                    disabled
                >
                    EVOLVE <i class="fas fa-play ml-2"></i>
                </button>
            </div>
        </div>

        <!-- ═══ SIMULATION SCREEN ═══ -->
        <div id="screen-sim" class="screen">
            <canvas id="world"></canvas>

            <div id="gen-summary" class="opacity-0">
                <div
                    class="text-lg font-bold text-cyan-300"
                    id="gen-summary-text"
                >
                </div>
            </div>

            <!-- Panel Toggle Buttons (Outside panels so they stay visible) -->
            <button class="panel-toggle-btn" id="toggle-top" data-panel="panel-top-bar" title="Toggle Top Panel" style="position: fixed; top: 8px; right: 50%; transform: translateX(50%); z-index: 100;">
                <i class="fas fa-chevron-up"></i>
            </button>
            <button class="panel-toggle-btn" id="toggle-left" data-panel="panel-progress-left" title="Toggle Left Panel" style="position: fixed; left: 8px; top: 50%; transform: translateY(-50%); z-index: 100;">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="panel-toggle-btn" id="toggle-right" data-panel="panel-controls" title="Toggle Right Panel" style="position: fixed; right: 8px; top: 50%; transform: translateY(-50%); z-index: 100;">
                <i class="fas fa-chevron-right"></i>
            </button>
            <button class="panel-toggle-btn" id="toggle-bottom" data-panel="panel-scorecard" title="Toggle Bottom Panel" style="position: fixed; bottom: 8px; right: 50%; transform: translateX(50%); z-index: 100;">
                <i class="fas fa-chevron-down"></i>
            </button>

            <!-- ─── Grid Chrome ─── -->
            <div id="sim-chrome" class="sim-chrome">
                <!-- ═══ TOP BAR: HUD + Neural ═══ -->
                <div
                    id="panel-top-bar"
                    class="sim-panel"
                    style="grid-area: top-bar; display: flex; border-bottom: 1px solid var(--border-color); border-radius: 0"
                >
                    <!-- HUD Panel -->
                    <div
                        id="panel-hud"
                        class="sim-panel"
                        style="flex: 0 0 auto; min-width: 420px; border-right: 1px solid var(--border-color); border-radius: 0; border: none"
                    >
                        <div class="sim-panel-title">
                            <span><i class="fas fa-chart-line mr-1"></i> Live
                                Stats</span>
                            <span
                                id="hud-mode"
                                class="text-cyan-300 text-[10px]"
                            >TRAIN</span>
                        </div>
                        <div class="score-grid">
                            <div>
                                <div class="score-label">Generation</div>
                                <div
                                    class="score-value text-white"
                                    id="hud-gen"
                                >
                                    1
                                </div>
                            </div>
                            <div>
                                <div class="score-label">Gen Best</div>
                                <div
                                    class="score-value text-cyan-300"
                                    id="hud-genbest"
                                >
                                    0m
                                </div>
                            </div>
                            <div>
                                <div class="score-label">All-Time</div>
                                <div
                                    class="score-value text-[var(--primary)]"
                                    id="hud-allbest"
                                >
                                    0m
                                </div>
                            </div>
                            <div>
                                <div class="score-label">Delta</div>
                                <div
                                    class="score-value text-emerald-300"
                                    id="hud-improve"
                                >
                                    +0m
                                </div>
                            </div>
                            <div>
                                <div class="score-label">Stagnant</div>
                                <div
                                    class="score-value text-amber-300"
                                    id="hud-stagnant"
                                >
                                    0g
                                </div>
                            </div>
                            <div>
                                <div class="score-label">Time Left</div>
                                <div
                                    class="score-value text-yellow-300"
                                    id="hud-time"
                                >
                                    8.0s
                                </div>
                            </div>
                            <div>
                                <div class="score-label">Elapsed</div>
                                <div
                                    class="score-value text-purple-300"
                                    id="hud-elapsed"
                                >
                                    0:00
                                </div>
                            </div>
                            <div>
                                <div class="score-label">Active</div>
                                <div
                                    class="score-value text-lime-300"
                                    id="hud-poplive"
                                >
                                    0/0
                                </div>
                            </div>
                            <div>
                                <div class="score-label">FPS</div>
                                <div
                                    class="score-value text-gray-400"
                                    id="hud-fps"
                                >
                                    60
                                </div>
                            </div>
                            <div>
                                <div class="score-label">Eff. Mut</div>
                                <div
                                    class="score-value text-pink-300"
                                    id="hud-effmut"
                                >
                                    8%
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Neural Panel -->
                    <div
                        id="panel-neural"
                        class="sim-panel grid-lines"
                        style="flex: 1; border-radius: 0; border: none; overflow: hidden; display: flex; flex-direction: column;"
                    >
                        <div
                            class="sim-panel-title"
                            style="border-color: var(--secondary); flex-shrink: 0;"
                        >
                            <span><i class="fas fa-brain mr-1"></i> Neural
                                Network</span>
                            <span class="text-[var(--secondary)]">LIVE</span>
                        </div>
                        <div style="display: flex; flex: 1; min-height: 0;">
                            <div style="flex: 0 0 380px; min-width: 0">
                                <canvas
                                    id="nn-canvas"
                                    width="380"
                                    height="92"
                                    class="w-full h-full"
                                ></canvas>
                            </div>
                            <div id="top-metrics-container" style="flex: 1; min-width: 0; border-left: 1px solid var(--border-color); display: flex; gap: 0; padding: 4px;">
                                <!-- Individual metric mini-graphs will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ═══ RIGHT PANEL: Controls ═══ -->
                <div
                    id="panel-controls"
                    class="sim-panel"
                    style="grid-area: right; width: 340px; border-left: 1px solid var(--border-color); border-radius: 0; overflow-y: auto; max-height: 100%; padding: 10px"
                >
                    <!-- SANDBOX MODE CONTROLS (shown only in sandbox) -->
                    <div id="sandbox-panel-section" class="hidden">
                        <div class="control-group">
                            <div class="control-label" style="display: flex; justify-content: space-between; align-items: center;">
                                <span><i class="fas fa-gamepad mr-1 text-emerald-400"></i> Sandbox Controls</span>
                                <span class="text-emerald-400 text-[10px]" id="sandbox-mode-badge">RUN 1</span>
                            </div>
                        </div>
                        
                        <!-- Sim Speed Control -->
                        <div class="control-group">
                            <div class="control-label">Simulation Speed</div>
                            <input type="range" id="inp-sandbox-speed" min="1" max="20" value="1" class="w-full" style="width: 100%;">
                            <div class="flex justify-between text-[10px] text-gray-500 mt-1">
                                <span>1x</span>
                                <span id="val-sandbox-speed">1x</span>
                                <span>20x</span>
                            </div>
                        </div>
                        
                        <!-- Sandbox Stats -->
                        <div class="sandbox-stats-inline">
                            <div class="sandbox-stat-inline">
                                <span class="sandbox-stat-label-inline">Distance</span>
                                <span class="sandbox-stat-value-inline text-cyan-300" id="sandbox-stat-dist">0.0m</span>
                            </div>
                            <div class="sandbox-stat-inline">
                                <span class="sandbox-stat-label-inline">Speed</span>
                                <span class="sandbox-stat-value-inline text-purple-300" id="sandbox-stat-speed">0.0 m/s</span>
                            </div>
                            <div class="sandbox-stat-inline">
                                <span class="sandbox-stat-label-inline">Stability</span>
                                <span class="sandbox-stat-value-inline text-emerald-300" id="sandbox-stat-stability">0%</span>
                            </div>
                            <div class="sandbox-stat-inline">
                                <span class="sandbox-stat-label-inline">Falls</span>
                                <span class="sandbox-stat-value-inline text-red-300" id="sandbox-stat-falls">0</span>
                            </div>
                        </div>
                        
                        <!-- Sandbox Action Buttons -->
                        <div class="flex gap-2 mt-3">
                            <button id="btn-sandbox-pause-panel" class="flex-1 py-3 rounded-lg bg-amber-500/20 text-amber-300 hover:bg-amber-500/30 border border-amber-400/40 font-semibold text-sm">
                                <i class="fas fa-pause mr-1"></i> Pause
                            </button>
                            <button id="btn-sandbox-reset-panel" class="flex-1 py-3 rounded-lg bg-blue-500/20 text-blue-300 hover:bg-blue-500/30 border border-blue-400/40 font-semibold text-sm">
                                <i class="fas fa-redo mr-1"></i> Reset
                            </button>
                        </div>
                        <div class="flex gap-2 mt-2">
                            <button id="btn-sandbox-exit-panel" class="flex-1 py-3 rounded-lg bg-red-500/20 text-red-300 hover:bg-red-500/30 border border-red-400/40 font-semibold text-sm">
                                <i class="fas fa-sign-out-alt mr-1"></i> Exit
                            </button>
                        </div>
                        
                        <div class="section-divider"></div>
                        
                        <!-- Live Graphs -->
                        <div class="control-group">
                            <div class="control-label">Live Metrics (60s)</div>
                            <div class="sandbox-graphs-grid">
                                <div class="sandbox-graph-container">
                                    <canvas id="sandbox-graph-distance" width="320" height="100"></canvas>
                                    <div class="sandbox-graph-label">Distance</div>
                                </div>
                                <div class="sandbox-graph-container">
                                    <canvas id="sandbox-graph-speed" width="320" height="100"></canvas>
                                    <div class="sandbox-graph-label">Speed</div>
                                </div>
                                <div class="sandbox-graph-container">
                                    <canvas id="sandbox-graph-stability" width="320" height="100"></canvas>
                                    <div class="sandbox-graph-label">Stability</div>
                                </div>
                                <div class="sandbox-graph-container">
                                    <canvas id="sandbox-graph-actuation" width="320" height="100"></canvas>
                                    <div class="sandbox-graph-label">Actuation</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Environment Controls (visible in sandbox) -->
                        <div class="section-divider"></div>
                        <div class="control-group">
                            <div class="control-label">Environment</div>
                            <div class="grid grid-cols-2 gap-2">
                                <button id="btn-sandbox-ground" class="cam-btn">
                                    Draw Ground
                                </button>
                                <button id="btn-sandbox-box" class="cam-btn">
                                    Add Box
                                </button>
                                <button id="btn-sandbox-triangle" class="cam-btn">
                                    Add Triangle
                                </button>
                                <button id="btn-sandbox-clear" class="cam-btn">
                                    Clear All
                                </button>
                            </div>
                            <div class="info-text mt-1" id="sandbox-tool-status">
                                Click world to place
                            </div>
                        </div>
                    </div>
                    
                    <!-- TRAINING MODE CONTROLS (hidden in sandbox) -->
                    <div id="training-sections">
                    <!-- Ghost Population Controls -->
                    <div class="control-group" style="margin-bottom: 8px;">
                        <div class="control-label">Ghosts</div>
                        <div class="flex gap-2">
                            <button id="ghosts-on" class="toggle-btn active">
                                <i class="fas fa-eye mr-1"></i>Show
                            </button>
                            <button id="ghosts-off" class="toggle-btn">
                                <i class="fas fa-eye-slash mr-1"></i>Hide All
                            </button>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-between gap-2">
                        <button
                            id="btn-start-sim"
                            class="flex-1 py-2 rounded-lg bg-emerald-500/15 text-emerald-300 hover:bg-emerald-500/25 border border-emerald-400/30 font-medium text-sm"
                            title="Start Simulation"
                        >
                            <i class="fas fa-play"></i>
                            <span id="start-sim-label" class="ml-1"
                            >Start Sim</span>
                        </button>
                        <button
                            id="btn-pause"
                            class="flex-1 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 text-sm"
                            title="Pause/Play"
                        >
                            <i class="fas fa-pause" id="icon-pause"></i>
                        </button>
                        <button
                            id="btn-reset"
                            class="flex-1 py-2 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 border border-red-500/30 text-sm"
                            title="Restart"
                        >
                            <i class="fas fa-redo"></i>
                        </button>
                        <button
                            id="btn-edit"
                            class="flex-1 py-2 rounded-lg bg-[var(--primary)] text-black font-bold hover:brightness-110 shadow-[0_0_10px_rgba(0,242,255,0.3)] text-sm"
                            title="Edit"
                        >
                            <i class="fas fa-pencil"></i>
                        </button>
                    </div>
                    <button
                        id="btn-reset-settings"
                        class="w-full py-2 mt-2 rounded-lg bg-white/4 hover:bg-white/8 border border-white/8 text-xs text-gray-400"
                    >
                        Reset Settings to Defaults
                    </button>

                    <div class="section-divider"></div>

                    <!-- Challenges -->
                    <div class="control-group">
                        <div class="control-label">Challenges</div>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="btn-ground-draw" class="cam-btn">
                                Draw Ground
                            </button>
                            <button id="btn-ground-clear" class="cam-btn">
                                Clear Ground
                            </button>
                            <button id="btn-obstacle-add" class="cam-btn">
                                Add Obstacle
                            </button>
                            <button id="btn-challenge-clear" class="cam-btn">
                                Clear All
                            </button>
                        </div>
                        <div class="info-text mt-1">
                            Draw mode: click world to add line points.
                        </div>
                    </div>

                    <!-- Brains -->
                    <div class="control-group" id="brain-library-section">
                        <div class="control-label">Brains</div>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="btn-brain-save" class="cam-btn">
                                Save Best
                            </button>
                            <button id="btn-sandbox-run" class="cam-btn cam-btn-big sandbox-run-btn">
                                Run Sandbox
                            </button>
                        </div>
                        <select
                            id="brain-library-select"
                            class="bg-white/5 border border-white/8 rounded-lg px-2 py-2 text-xs text-gray-300 cursor-pointer hover:bg-white/10 mt-2 w-full"
                            style="font-family: 'JetBrains Mono', monospace"
                        >
                            <option value="">No saved brains</option>
                        </select>
                        <div class="grid grid-cols-2 gap-2 mt-2">
                            <button id="btn-sandbox-exit" class="cam-btn cam-btn-big sandbox-exit-btn" style="display: none;">
                                Exit Sandbox
                            </button>
                            <button id="btn-brain-delete" class="cam-btn">
                                Delete Brain
                            </button>
                        </div>
                        <div id="brain-library-meta" class="info-text mt-1">
                            Run at least one generation, then save.
                        </div>
                    </div>

                    <!-- Fitness Breakdown -->
                    <div class="control-group">
                        <div class="control-label">
                            Fitness Breakdown <span
                                class="control-val"
                                id="fitness-tag"
                            >LIVE</span>
                        </div>
                        <div id="fitness-cards" class="grid grid-cols-2 gap-2">
                            <div class="fitness-card">
                                <div class="fitness-card-label">Speed</div>
                                <div
                                    class="fitness-card-value text-cyan-300"
                                    id="fitness-speed"
                                >
                                    0.0
                                </div>
                            </div>
                            <div class="fitness-card">
                                <div class="fitness-card-label">Stability</div>
                                <div
                                    class="fitness-card-value text-emerald-300"
                                    id="fitness-stability"
                                >
                                    0%
                                </div>
                            </div>
                            <div class="fitness-card">
                                <div class="fitness-card-label">Energy</div>
                                <div class="fitness-card-value" style="display: flex; flex-direction: column; gap: 4px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span id="fitness-energy" class="text-violet-300">100%</span>
                                    </div>
                                    <div style="width: 100%; height: 6px; background: rgba(139, 92, 246, 0.2); border-radius: 3px; overflow: hidden;">
                                        <div id="fitness-energy-bar" style="width: 100%; height: 100%; background: linear-gradient(90deg, #8b5cf6, #a78bfa); transition: width 0.2s ease;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="fitness-card">
                                <div class="fitness-card-label">Stumbles</div>
                                <div
                                    class="fitness-card-value text-rose-300"
                                    id="fitness-stumbles"
                                >
                                    0
                                </div>
                            </div>
                            <div class="fitness-card">
                                <div class="fitness-card-label">Spin</div>
                                <div
                                    class="fitness-card-value text-orange-400"
                                    id="fitness-spin"
                                >
                                    0.0
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="control-group">
                        <div class="control-label">Self Collision</div>
                        <div class="flex gap-2">
                            <button id="selfcol-on" class="toggle-btn active">
                                <i class="fas fa-check mr-1"></i>On
                            </button>
                            <button id="selfcol-off" class="toggle-btn">
                                <i class="fas fa-xmark mr-1"></i>Off
                            </button>
                        </div>
                    </div>

                    <!-- Camera -->
                    <div class="control-group">
                        <div class="control-label">
                            Camera <span class="control-val" id="val-cam"
                            >LOCK</span>
                        </div>
                        <div class="flex gap-2">
                            <button id="cam-lock" class="cam-btn active">
                                Lock
                            </button>
                            <button id="cam-free" class="cam-btn">Free</button>
                            <button id="cam-reset" class="cam-btn">
                                Reset
                            </button>
                        </div>
                    </div>

                    <!-- Sim Speed -->
                    <div class="control-group">
                        <div class="control-label">
                            Simulation Speed <span
                                class="control-val"
                                id="val-speed"
                            >1x</span>
                        </div>
                        <input
                            type="range"
                            id="inp-speed"
                            min="1"
                            max="50"
                            value="1"
                            step="1"
                        >
                    </div>

                    <!-- Zoom -->
                    <div class="control-group">
                        <div class="control-label">
                            Zoom <span class="control-val" id="val-zoom"
                            >1.00x</span>
                        </div>
                        <input
                            type="range"
                            id="inp-zoom"
                            min="35"
                            max="250"
                            value="100"
                            step="5"
                        >
                    </div>

                    <!-- Generation Time -->
                    <div class="control-group">
                        <div class="control-label">
                            Generation Time <span
                                class="control-val"
                                id="val-duration"
                            >8s</span>
                        </div>
                        <input
                            type="range"
                            id="inp-duration"
                            min="4"
                            max="60"
                            value="8"
                            step="1"
                        >
                    </div>

                    <!-- Population -->
                    <div class="control-group">
                        <div class="control-label">
                            Population <span class="control-val" id="val-pop"
                            >24</span>
                        </div>
                        <input
                            type="range"
                            id="inp-pop"
                            min="8"
                            max="200"
                            value="24"
                            step="4"
                        >
                    </div>

<!-- Neural Network Architecture - Auto-evolves, not manually controlled -->
<div class="section-divider"></div>
<div class="section-title text-purple-400">
  Neural Network <span class="text-xs text-gray-400">(Auto-Evolving)</span>
</div>

<div class="control-group">
  <div class="control-label">
    Architecture <span
    class="control-val"
    id="val-nn-arch"
    >Simple</span>
  </div>
  <div class="text-xs text-gray-400 mt-1" style="font-family: 'JetBrains Mono', monospace">
    Starts minimal, grows with fitness
  </div>
</div>

                    <div class="section-divider"></div>
                    <div class="section-title text-amber-400">Physics</div>

<div class="control-group">
<div class="control-label">
Muscle Power <span
class="control-val"
id="val-strength"
>100%</span
>
<span class="text-xs text-gray-500">(contraction force)</span>
</div>
<input
type="range"
id="inp-strength"
min="50"
max="300"
value="100"
step="10"
>
</div>

                    <div class="control-group">
                        <div class="control-label">
                            Gravity <span class="control-val" id="val-gravity"
                            >9.8</span>
                        </div>
                        <input
                            type="range"
                            id="inp-gravity"
                            min="1.0"
                            max="20.0"
                            value="9.8"
                            step="0.1"
                        >
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            Ground Friction <span
                                class="control-val"
                                id="val-groundfric"
                            >0.95</span>
                        </div>
                        <input
                            type="range"
                            id="inp-groundfric"
                            min="0.1"
                            max="1.0"
                            value="0.95"
                            step="0.05"
                        >
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            Muscle Min Length <span
                                class="control-val"
                                id="val-musminlen"
                            >80%</span>
                            <span class="text-xs text-gray-500">(50-100%)</span>
                        </div>
                        <input
                            type="range"
                            id="inp-musminlen"
                            min="50"
                            max="100"
                            value="80"
                            step="5"
                        >
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            Muscle Max Length <span
                                class="control-val"
                                id="val-musmaxlen"
                            >110%</span>
                            <span class="text-xs text-gray-500">(100-150%)</span>
                        </div>
                        <input
                            type="range"
                            id="inp-musmaxlen"
                            min="100"
                            max="150"
                            value="110"
                            step="5"
                        >
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            Muscle Speed <span
                                class="control-val"
                                id="val-musmooth"
                            >10.0%</span>
                            <span class="text-xs text-gray-500">(1.0%=slow/no jitter · 10.0%=fast/may jitter)</span>
                        </div>
<input
                type="range"
                id="inp-musmooth"
                min="10"
                max="100"
                value="100"
                step="1"
              >
            </div>

            <div class="section-divider"></div>
                    <div class="section-title text-violet-400">
                        Energy System
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            Max Energy <span
                                class="control-val"
                                id="val-maxenergy"
                            >100</span>
                        </div>
                        <input
                            type="range"
                            id="inp-maxenergy"
                            min="50"
                            max="300"
                            value="100"
                            step="10"
                        >
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            Regen Rate <span
                                class="control-val"
                                id="val-regen"
                            >35/s</span>
                        </div>
                        <input
                            type="range"
                            id="inp-regen"
                            min="10"
                            max="100"
                            value="35"
                            step="5"
                        >
                    </div>

<div class="control-group">
<div class="control-label">
Energy Cost <span
class="control-val"
id="val-energycost"
>0.80</span>
</div>
<input
type="range"
id="inp-energycost"
min="20"
max="200"
value="80"
step="10"
>
</div>

<div class="control-group">
<div class="control-label">
Base Drain <span
class="control-val"
id="val-basedrain"
>0.02</span>
</div>
<input
type="range"
id="inp-basedrain"
min="0"
max="10"
value="2"
step="1"
>
</div>

<div class="control-group">
<div class="control-label">Energy System</div>
<div class="flex gap-2 mt-1">
<button id="energy-on" class="toggle-btn flex-1"><i class="fas fa-check mr-1"></i>On</button>
<button id="energy-off" class="toggle-btn flex-1"><i class="fas fa-xmark mr-1"></i>Off</button>
</div>
</div>

                    <div class="section-divider"></div>
                    <div class="section-title text-pink-400">Fitness Penalties</div>

                    <div class="control-group">
                        <div class="control-label">
                            Ground Slip Penalty <span class="control-val" id="val-slippen">5</span>
                        </div>
                        <input
                            type="range"
                            id="inp-slippen"
                            min="0"
                            max="20"
                            value="5"
                            step="1"
                        >
                        <span class="text-xs text-gray-500">(0=off · higher=penalize jitter sliding more)</span>
                    </div>

                    <div class="section-divider"></div>
                    <div class="section-title text-pink-400">Mutation</div>

                    <div class="control-group">
                        <div class="control-label">
                            Mutation Rate <span class="control-val" id="val-mut"
                            >8%</span>
                        </div>
                        <input
                            type="range"
                            id="inp-mut"
                            min="0"
                            max="60"
                            value="8"
                            step="1"
                        >
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            Mutation Size <span
                                class="control-val"
                                id="val-mutsize"
                            >1.00x</span>
                        </div>
                        <input
                            type="range"
                            id="inp-mutsize"
                            min="20"
                            max="400"
                            value="100"
                            step="5"
                        >
                    </div>

                    <div
                        class="info-text"
                        style="margin-top: 8px; padding: 8px; background: rgba(255, 255, 255, 0.02); border-radius: 6px"
                    >
                        Real feedforward neural network brain.<br>
                        Each creature's DNA = NN weight vector.<br>
                        Evolution: tournament selection + uniform crossover +
                        gaussian mutation.
                    </div>
                </div>
                </div>

<!-- ═══ BOTTOM PANEL: Training Details ═══ -->
<div
id="panel-scorecard"
class="sim-panel"
style="grid-area: bottom; border-top: 1px solid var(--border-color); border-radius: 0; overflow-y: auto; min-height: 140px; max-height: 260px; padding: 0 12px 10px; display: flex; flex-direction: column;"
>
                    <!-- TRAINING MODE DETAILS -->
                    <div id="training-details" class="h-full flex flex-col">
                        <div class="sim-panel-title" style="border: none; padding: 4px 0 2px">
                            <span><i class="fas fa-chart-bar mr-1"></i> Current Run</span>
                            <span id="score-mode" class="text-cyan-300 text-[9px]">TRAINING</span>
                        </div>
                        <!-- Individual metric graphs in horizontal layout -->
                        <div id="bottom-metrics-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; padding: 4px 0 8px; flex: 1;"></div>
                    </div>

                    <!-- SANDBOX MODE SCORECARD -->
                    <div id="sandbox-scorecard-wrap" class="hidden h-full flex flex-col justify-center">
                        <div class="sim-panel-title" style="border: none; padding: 4px 0 8px">
                            <span><i class="fas fa-gamepad mr-2 text-emerald-400"></i> Sandbox Mode</span>
                            <span id="sandbox-run-label" class="text-emerald-400 text-[10px] tracking-wider">RUN 1</span>
                        </div>
                        <div class="grid grid-cols-3 gap-3 text-center">
                            <div class="fitness-card" style="padding: 12px 6px">
                                <div class="fitness-card-label" style="font-size: 10px">Distance Reached</div>
                                <div class="fitness-card-value text-emerald-300" style="font-size: 20px" id="sandbox-distance">0.0m</div>
                            </div>
                            <div class="fitness-card" style="padding: 12px 6px">
                                <div class="fitness-card-label" style="font-size: 10px">Current Speed</div>
                                <div class="fitness-card-value text-cyan-300" style="font-size: 20px" id="sandbox-speed">0.0 m/s</div>
                            </div>
                            <div class="fitness-card" style="padding: 12px 6px">
                                <div class="fitness-card-label" style="font-size: 10px">Stability</div>
                                <div class="fitness-card-value text-purple-300" style="font-size: 20px" id="sandbox-stability">0%</div>
                            </div>
                            <div class="fitness-card" style="padding: 12px 6px">
                                <div class="fitness-card-label" style="font-size: 10px">Stumbles</div>
                                <div class="fitness-card-value text-rose-300" style="font-size: 20px" id="sandbox-falls">0</div>
                            </div>
                            <div class="fitness-card" style="padding: 12px 6px">
                                <div class="fitness-card-label" style="font-size: 10px">Ground Slip</div>
                                <div class="fitness-card-value text-yellow-300" style="font-size: 20px" id="sandbox-slip">0.00</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ─── Toggle Tab Buttons (Visible clickable tabs) ─── -->
                <!-- Canvas area (invisible, just occupies grid space) -->
                <div class="sim-canvas-area"></div>

                <!-- ═══ LEFT PANEL: Evolution Progress ═══ -->
                <div
                    id="panel-progress-left"
                    class="sim-panel"
                    style="grid-area: left; width: 320px; border-right: 1px solid var(--border-color); border-radius: 0;"
                >
                    <div
                        class="sim-panel-title"
                        style="border-color: rgba(0, 242, 255, 0.3)"
                    >
                        <span><i class="fas fa-dna mr-1"></i> Evolution</span>
                        <span id="left-graph-meta" class="text-cyan-300"
                        >G1</span>
                    </div>

                    <!-- ═══ EVOLUTION FEEDBACK ═══ -->
                    <div id="evolution-feedback" style="padding: 0 10px 6px; flex-shrink: 0;">
                        <div class="sim-panel-title" style="padding: 6px 0; border: none">
                            <span><i class="fas fa-heartbeat mr-1"></i> Evolution Health</span>
                            <span id="evo-status-badge" class="evo-status-badge severity-info">○ Starting</span>
                        </div>

                        <div style="padding: 8px; background: rgba(0,0,0,0.2); border-radius: 6px; margin-bottom: 8px">
                            <div id="evo-message" class="text-xs text-gray-300" style="font-family: 'JetBrains Mono', monospace">
                                Analyzing evolution progress...
                            </div>
                            <div id="evo-insights" class="text-xs mt-2 flex flex-wrap gap-2" style="font-family: 'JetBrains Mono', monospace">
                            </div>
                        </div>

<!-- Suggestions Panel removed - user controls settings manually -->
<div id="suggestions-panel" class="hidden">
  <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 6px; padding: 8px; margin-bottom: 8px">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px">
      <div class="text-xs font-bold text-amber-400" style="font-family: 'JetBrains Mono', monospace">
        ⚠ SUGGESTIONS
      </div>
      <button onclick="window.evolutionFeedback?.dismissSuggestions()" class="text-xs text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="suggestions-list" style="display: flex; flex-direction: column; gap: 6px">
      <!-- Suggestions will be inserted here -->
    </div>
  </div>
</div>

<!-- Sandbox Scorecard for Left Panel (hidden until sandbox mode) -->
<div
id="sandbox-scorecard-left-panel"
style="display: none; padding: 0 10px 10px"
>
<div class="section-divider"></div>
<div
class="sim-panel-title"
style="padding: 6px 0; border: none"
>
<span><i class="fas fa-flask mr-1"></i> Sandbox
Scorecard</span>
<span
id="sandbox-run-label-left"
class="text-emerald-300"
>Run 0</span>
</div>
<div class="sandbox-scorecard">
<div class="sandbox-stat">
<div class="sandbox-stat-label">Distance</div>
<div
class="sandbox-stat-value text-cyan-300"
id="sandbox-distance-left"
>
0.0m
</div>
</div>
<div class="sandbox-stat">
<div class="sandbox-stat-label">Max Speed</div>
<div
class="sandbox-stat-value text-yellow-300"
id="sandbox-speed-left"
>
0.0
</div>
</div>
<div class="sandbox-stat">
<div class="sandbox-stat-label">Stability</div>
<div
class="sandbox-stat-value text-emerald-300"
id="sandbox-stability-left"
>
0%
</div>
</div>
<div class="sandbox-stat">
<div class="sandbox-stat-label">Falls</div>
<div
class="sandbox-stat-value text-rose-300"
id="sandbox-falls-left"
>
0
</div>
</div>
<div class="sandbox-stat">
<div class="sandbox-stat-label">
Ground Slip
</div>
<div
class="sandbox-stat-value text-orange-300"
id="sandbox-slip-left"
>
0.00
</div>
</div>
</div>
</div>
                    </div>

                    <!-- Individual metric graphs container -->
                    <div id="left-metrics-container" style="padding: 4px 8px 8px; display: flex; flex-direction: column; gap: 4px;"></div>
                </div>

            <div class="edge-tab-rail edge-top-rail pointer-events-auto">
                <button
                    class="edge-tab active"
                    data-target="panel-top-bar"
                    title="Toggle Stats Panel"
                >
                    <i class="fas fa-chart-line"></i> Stats
                </button>
            </div>
            <div class="edge-tab-rail edge-left-rail pointer-events-auto">
                <button
                    class="edge-tab active"
                    data-target="panel-progress-left"
                    title="Toggle Evolution Panel"
                >
                    <i class="fas fa-dna"></i> Evolution
                </button>
            </div>
            <div class="edge-tab-rail edge-right-rail pointer-events-auto">
                <button
                    class="edge-tab active"
                    data-target="panel-controls"
                    title="Toggle Controls Panel"
                >
                    <i class="fas fa-sliders"></i> Controls
                </button>
            </div>
            <div class="edge-tab-rail edge-bottom-rail pointer-events-auto">
                <button
                    class="edge-tab active"
                    data-target="panel-scorecard"
                    title="Toggle Current Run Panel"
                >
                    <i class="fas fa-chart-bar"></i> Current Run
                </button>
            </div>
        </div>

        <script type="module" src="./main.js"></script>
    </body>
</html>
